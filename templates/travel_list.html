{% extends 'base.html' %}
{% block content %}
<h2>Available Travel Options</h2>

<form method="get" class="row g-3 mb-4">
  <div class="col-md-2">
    <label class="form-label">Type</label>
    <select name="type" class="form-select">
      <option value="All">All</option>
      <option value="Flight" {% if selected_type == "Flight" %}selected{% endif %}>Flight</option>
      <option value="Train" {% if selected_type == "Train" %}selected{% endif %}>Train</option>
      <option value="Bus" {% if selected_type == "Bus" %}selected{% endif %}>Bus</option>
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Source</label>
    <input type="text" name="source" value="{{ source }}" class="form-control">
  </div>
  <div class="col-md-3">
    <label class="form-label">Destination</label>
    <input type="text" name="destination" value="{{ destination }}" class="form-control">
  </div>
  <div class="col-md-2">
    <label class="form-label">Date</label>
    <input type="date" name="date" value="{{ date }}" class="form-control">
  </div>
  <div class="col-md-2 d-flex align-items-end">
    <button type="submit" class="btn btn-primary w-100">Search</button>
  </div>
</form>

<table class="table">
  <tr><th>Type</th><th>From</th><th>To</th><th>Date</th><th>Price</th><th>Seats</th><th>Action</th></tr>
  {% for travel in travels %}
  <tr>
    <td>{{ travel.type }}</td>
    <td>{{ travel.source }}</td>
    <td>{{ travel.destination }}</td>
    <td>{{ travel.date_time }}</td>
    <td>{{ travel.price }}</td>
    <td>{{ travel.available_seats }}</td>
    <td>
      {% if travel.available_seats > 0 %}
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#selectSeatsModal{{ travel.travel_id }}">Book Seat</button>

        <div class="modal fade" id="selectSeatsModal{{ travel.travel_id }}" tabindex="-1" aria-labelledby="modalLabel{{ travel.travel_id }}" aria-hidden="true">
          <div class="modal-dialog">
            <form method="post" action="{% url 'book_travel' travel.travel_id %}">
              {% csrf_token %}
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalLabel{{ travel.travel_id }}">Select Seats for {{ travel.type }} from {{ travel.source }} to {{ travel.destination }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <p>Available seats: <strong>{{ travel.available_seats }}</strong></p>
                  <div class="mb-3">
                    <label for="num_seats_{{ travel.travel_id }}" class="form-label">Number of seats to book:</label>
                    <input type="number" id="num_seats_{{ travel.travel_id }}" name="num_seats" min="1" max="{{ travel.available_seats }}" value="1" class="form-control" required>
                  </div>
                  <small class="text-muted">Select the number of seats and confirm your booking.</small>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary">Confirm Seat</button>
                </div>
              </div>
            </form>
          </div>
        </div>

      {% else %}
      <span class="badge bg-danger">Sold Out</span>
      {% endif %}
    </td>
  </tr>
  {% empty %}
  <tr><td colspan="7" class="text-center">No travel options found.</td></tr>
  {% endfor %}
</table>
{% endblock %}
